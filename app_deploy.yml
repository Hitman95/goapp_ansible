
- hosts: web
  vars:
     site_name: hitman959.devops.srwx.net

  tasks:
  - name: Installing packages
    apt: name={{item}} state=latest
    with_items:
        - nginx
        - php-fpm
        - git
        - golang
      
  - name: Remove default config
    file: path=/etc/nginx/sites-enabled/default state=absent
    notify: restart nginx
   
  - name: Install site config
    template: src=templates/{{site_name}}.j2 dest=/etc/nginx/sites-available/{{site_name}} owner=root group=root mode=0644
    notify: restart nginx

  - name: Create link
    file: src=/etc/nginx/sites-available/{{site_name}} dest=/etc/nginx/sites-enabled/{{site_name}} state=link owner=root group=root mode=0644
    notify: restart nginx

  - name: Clone goapp-web
    git:
     repo: https://github.com/vozerov/goapp-web.git
     dest: /srv/goapp-web
     clone: yes

  handlers:
    - name: restart nginx
      service: name=nginx state=restarted

