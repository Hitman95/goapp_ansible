server {
	listen 80;

	server_name {{site_name}};

	location /.well-known/ {
	 root /srv/acme;
	}

	location / { 
	 return 301 https://{{site_name}}$request_uri;
	}
}

server {
	listen 443 ssl;

	ssl_certificate /etc/letsencrypt/live/{{site_name}}/fullchain.pem;
	ssl_certificate_key /etc/letsencrypt/{{site_name}}/privkey.pem;

	location / {
	 root /srv/goapp-web;
	}

	location ~ /\.ht|.git {
	 deny all;
	}

	location /api/sum {
	 rewrite ^/api/(.*)$ /$1 break;
         proxy_pass http://localhost:8080;
	}

	location /api/diff {
	 include fastcgi_params;
         fastcgi_param SCRIPT_FILENAME /srv/phpapp/diff.php;
	 fastcgi_pass unix://var/run/php/php7.0-fpm.sock;
	}

}
